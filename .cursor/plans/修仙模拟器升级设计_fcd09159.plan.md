---
name: 修仙模拟器升级设计
overview: 对标太吾绘卷、鬼谷八荒等市场头部修仙游戏，从 UI 炫酷化、新玩法机制和趣味互动三个维度对修仙世界模拟器进行系统性升级设计。
todos:
  - id: ui-theme
    content: 全局仙侠主题CSS系统：深墨黑+仙气金配色，磨砂半透明面板，描金边框
    status: completed
  - id: pixi-effects
    content: Pixi.js粒子特效层：境界突破金光柱、天劫雷电、角色灵气光环
    status: completed
  - id: event-panel-upgrade
    content: 事件面板视觉升级：按事件类型分色+图标，重要事件卡片化
    status: completed
  - id: avatar-panel-upgrade
    content: 角色详情面板升级：境界进度条动画、属性浮动数字、关系图谱
    status: completed
  - id: map-upgrade
    content: 世界地图视觉升级：宗门图标、强力角色光晕、战斗地块闪烁
    status: completed
  - id: heavenly-dao-panel
    content: 天道干预面板：天道积分系统+福缘/天劫/重生等6种权能
    status: completed
  - id: ranking-panel
    content: 天骄榜/排行榜面板：修为榜、杀戮榜、宗门榜，点击飞转地图
    status: completed
  - id: tournament
    content: 比武大会完整实现：对阵树形图、LLM生成战报、奖励结算
    status: completed
  - id: chronicle
    content: 世界年鉴：重要事件归档、LLM生成年度大事记、角色传记
    status: completed
  - id: world-crisis
    content: 灭世危机/兽潮世界事件：触发机制、联合防御、正魔大战
    status: completed
  - id: prophecy
    content: 预言系统：花费天道积分窥视天机，古风预言体LLM生成
    status: completed
isProject: false
---

# 修仙世界模拟器 全面升级设计方案

## 对标分析


| 维度   | 太吾绘卷 | 鬼谷八荒 | 本项目现状 | 目标         |
| ---- | ---- | ---- | ----- | ---------- |
| UI风格 | 水墨古风 | 唯美仙侠 | 简洁现代  | 深色仙气风格     |
| 信息密度 | 高    | 高    | 中     | 高，带可折叠层级   |
| 特效   | 少    | 丰富   | 无     | 境界/战斗/天劫特效 |
| 排行榜  | 有    | 有    | 无     | 天骄榜、宗门榜    |
| 天道干预 | 无    | 无    | 基础    | 深化为核心玩法    |
| 历史记录 | 有    | 有    | 事件流   | 年鉴/传记      |
| 世界事件 | 有    | 有    | 部分    | 兽潮/天灾/比武大会 |


---

## 一、UI炫酷化升级

### 1.1 全局视觉主题改造

**目标**：将当前Naive UI默认外观改造为深色仙侠风格。

- 新增全局CSS变量主题层（`web/src/assets/theme/cultivation-theme.css`）
  - 主色调：深墨黑 `#0a0e1a` + 仙气金 `#d4a843` + 灵力紫 `#7c3aed`
  - 边框：描金纹理边框（CSS渐变模拟）
  - 字体：引入"站酷庆科黄油体"或"霞鹜文楷"
  - 面板背景：半透明磨砂 + 水墨纹理叠加
- Naive UI全局主题配置（`web/src/App.vue` 的 `n-config-provider`）

### 1.2 Pixi.js 粒子特效系统

新增 `web/src/components/game/effects/` 目录：

- `**BreakthroughEffect.vue**` - 境界突破特效
  - 金色光柱 + 八卦旋转粒子
  - 触发条件：监听 `breakthrough` 类型事件
- `**TribulationEffect.vue**` - 天劫特效
  - 雷电粒子从天而降
  - 触发条件：监听 `tribulation` 事件
- `**AuraEffect.vue**` - 角色灵气光环
  - 根据境界显示不同颜色光晕（练气白、筑基绿、金丹金、元婴紫）

### 1.3 事件面板视觉升级（`EventPanel.vue`）

- 不同事件类型对应不同颜色标签和图标：
  - 战斗事件 🗡️ 红色
  - 突破事件 ⚡ 金色
  - 互动事件 💬 蓝色
  - 天劫事件 ☁️ 紫色
  - 商贸事件 💰 绿色
- 重要事件（`is_major=true`）展示为加宽卡片，带边框高亮
- 小剧场事件展开为模态框，背景带水墨渲染

### 1.4 角色详情面板升级（`AvatarDetail.vue`）

- 角色头像区：根据灵根属性显示五行颜色光环
- 境界进度条：金色渐变进度条，满格时触发脉冲动画
- 属性数值变化：+/- 数字浮动动画（类似ARPG伤害数字）
- 关系网络可视化：小型D3/ECharts关系图谱

### 1.5 世界地图升级（`MapLayer.vue`）

- 宗门驻地显示自定义图标（塔/殿/峰）
- 强力角色在地图上显示光晕光圈
- 战斗事件触发时在对应地块闪烁红色

---

## 二、新玩法机制

### 2.1 天骄榜 / 排行榜面板（新组件）

**新增** `web/src/components/game/panels/RankingPanel.vue`
**新增后端API** `GET /api/meta/rankings`

排行榜维度：

- 修为榜：当前境界最高的修士 Top 10
- 杀戮榜：击败对手最多的修士
- 宗门榜：宗门综合实力排名
- 长寿榜：当前年龄最大的修士

**触发联动**：点击排行条目 → 地图自动飞转至该角色位置 + 打开角色详情

### 2.2 比武大会（补完已规划功能）

后端：`src/classes/gathering/tournament.py`

- 淘汰赛/循环赛两种模式
- 胜出者获得灵石奖励、声望加成
- 生成专属小剧场：每场对决LLM生成战报

前端：`web/src/components/game/panels/TournamentPanel.vue`

- 对阵树形图展示
- 实时战报推送

### 2.3 世界年鉴（历史记录）

**新增** `web/src/components/game/panels/ChroniclePanel.vue`
**新增后端API** `GET /api/chronicle`

- 按年份归纳重要事件（`is_major=true` 的事件）
- "本年大事记"：每年年末自动生成LLM叙述的历史摘要
- 可查询任意年份的历史回顾
- 支持"角色传记"：以某角色为主线生成其一生经历

### 2.4 灭世危机 & 兽潮（世界级事件）

后端：`src/classes/gathering/world_crisis.py`

- **兽潮**：随机爆发，向城市/宗门方向涌进，各宗门联合防御
- **天地异变**：灵气暴走事件，全地图灵气密度剧变
- **魔道入侵**：特定NPC转化为魔道修士，触发正魔大战

前端：`StatusBar.vue` 显示危机倒计时 + 地图高亮危险区域

---

## 三、天道干预系统深化（核心玩法升级）

### 3.1 天道面板（新组件）

**新增** `web/src/components/game/panels/HeavenlyDaoPanel.vue`

玩家可主动施展的"天道权能"（消耗"天道积分"）：


| 权能   | 效果        | 消耗  |
| ---- | --------- | --- |
| 降下福缘 | 指定角色触发奇遇  | 10分 |
| 散功之祸 | 指定角色修为大减  | 20分 |
| 天雷惩戒 | 对指定角色降下天劫 | 30分 |
| 机缘引导 | 让两个角色相遇   | 15分 |
| 转世重生 | 重置角色记忆和位置 | 50分 |
| 点化众生 | 批量觉醒凡人灵根  | 40分 |


**天道积分获得**：随时间自动积累，重大世界事件额外奖励

### 3.2 预言系统（新功能）

- 玩家可花费积分"窥视天机"，预告未来2-5年某角色的命运走向
- LLM根据当前局势生成预言文本（古风预言体）
- 预言有概率成真，形成"因果自洽"

---

## 四、技术实施路径

### 阶段一：UI炫酷化（优先，约1-2周）

1. 全局主题CSS变量系统
2. Pixi粒子特效层（突破/天劫）
3. 事件面板颜色分类 + 重要事件卡片
4. 角色面板境界进度条动画

### 阶段二：天道干预深化（约1周）

1. 天道积分系统（后端）
2. 天道面板UI（前端）

### 阶段三：新玩法（约2-3周）

1. 天骄榜/排行榜
2. 比武大会
3. 世界年鉴
4. 兽潮/灭世危机

### 阶段四：预言与收尾（约1周）

1. 预言系统
2. 角色传记生成

---

## 关键文件涉及范围

- `[web/src/App.vue](web/src/App.vue)` - 主题注入
- `[web/src/assets/](web/src/assets/)` - 新增仙侠主题CSS和音效
- `[web/src/components/game/GameCanvas.vue](web/src/components/game/GameCanvas.vue)` - 挂载特效层
- `[web/src/components/game/panels/EventPanel.vue](web/src/components/game/panels/EventPanel.vue)` - 事件类型样式
- `[web/src/components/game/panels/info/AvatarDetail.vue](web/src/components/game/panels/info/AvatarDetail.vue)` - 进度条动画
- `[web/src/stores/world.ts](web/src/stores/world.ts)` - 天道积分状态
- `[src/server/main.py](src/server/main.py)` - 新增API路由
- `[src/classes/gathering/](src/classes/gathering/)` - 比武大会、兽潮实现
- `[src/systems/](src/systems/)` - 天道积分机制

